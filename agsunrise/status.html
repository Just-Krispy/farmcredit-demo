<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Application Status â€” Farm Credit SEMO</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f4f7f0;color:#1a2e1a;min-height:100vh}
    header{background:#2d5a1b;color:white;padding:16px 24px}.logo{font-size:20px;font-weight:700}.logo span{color:#8bc34a}
    .main{max-width:540px;margin:40px auto;padding:0 16px}
    .card{background:white;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,.1);padding:32px}
    .card h2{font-size:20px;font-weight:700;color:#2d5a1b;margin-bottom:8px}
    .card p{color:#666;font-size:14px;margin-bottom:20px}
    input{width:100%;padding:12px 16px;border:2px solid #ddd;border-radius:10px;font-size:16px;outline:none;letter-spacing:1px}
    input:focus{border-color:#2d5a1b}
    button{background:#2d5a1b;color:white;border:none;width:100%;padding:12px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;margin-top:12px}
    .result{display:none;margin-top:24px;border-top:1px solid #eee;padding-top:20px}
    .badge{display:inline-block;padding:7px 18px;border-radius:20px;font-weight:700;font-size:14px;margin:12px 0}
    .b-submitted{background:#cce5ff;color:#004085}.b-under_review{background:#fff3cd;color:#856404}
    .b-approved{background:#d4edda;color:#155724}.b-declined{background:#f8d7da;color:#721c24}
    .b-more_info{background:#f8d7da;color:#721c24}
    .tl{margin-top:20px}.tl-item{display:flex;gap:12px;margin-bottom:16px}
    .tl-dot{width:12px;height:12px;border-radius:50%;background:#2d5a1b;margin-top:4px;flex-shrink:0}
    .tl-dot.off{background:#ddd}
    .tl-text strong{display:block;font-size:14px}.tl-text span{color:#aaa;font-size:12px}
    .error{color:#dc3545;font-size:14px;margin-top:10px}
  </style>
</head>
<body>
<header><div class="logo">Farm Credit <span>SEMO</span></div></header>
<div class="main">
  <div class="card">
    <h2>ðŸŒ± Application Status</h2>
    <p>Enter your reference number to check your AgSunrise application status.</p>
    <input type="text" id="refIn" placeholder="AS-2025-0000"/>
    <button onclick="check()">Check Status</button>
    <div class="error" id="err"></div>
    <div class="result" id="result">
      <div style="font-size:13px;color:#888">Ref: <strong id="rRef"></strong> Â· Branch: <strong id="rBranch"></strong></div>
      <div class="badge" id="rBadge"></div>
      <div style="font-size:16px;font-weight:600" id="rName"></div>
      <div style="font-size:13px;color:#aaa;margin-top:4px">Submitted: <span id="rDate"></span></div>
      <div class="tl" id="tl"></div>
    </div>
  </div>
</div>
<script>
  const labels={submitted:'âœ… Submitted',under_review:'ðŸ” Under Review',more_info:'ðŸ“‹ More Info Needed',approved:'ðŸŽ‰ Approved!',declined:'âŒ Declined'};
  const classes={submitted:'b-submitted',under_review:'b-under_review',more_info:'b-more_info',approved:'b-approved',declined:'b-declined'};
  const params=new URLSearchParams(window.location.search);
  if(params.get('ref')){document.getElementById('refIn').value=params.get('ref');setTimeout(check,100);}
  function check(){
    const ref=document.getElementById('refIn').value.trim();
    if(!ref)return;
    document.getElementById('err').textContent='';
    const apps=JSON.parse(localStorage.getItem('fc_apps')||'[]');
    const a=apps.find(x=>x.ref_number===ref);
    if(!a){document.getElementById('err').textContent='Application not found. Please check your reference number.';document.getElementById('result').style.display='none';return;}
    document.getElementById('rRef').textContent=a.ref_number;
    document.getElementById('rBranch').textContent=a.branch;
    document.getElementById('rName').textContent=`${a.first_name} ${a.last_name} â€” AgSunrise Application`;
    document.getElementById('rDate').textContent=new Date(a.submitted_at).toLocaleDateString();
    const b=document.getElementById('rBadge');b.textContent=labels[a.status]||a.status;b.className='badge '+(classes[a.status]||'');
    const done=(s)=>['submitted','under_review','more_info','approved','declined'].indexOf(a.status)>=['submitted','under_review','more_info','approved','declined'].indexOf(s);
    document.getElementById('tl').innerHTML=[
      {l:'Application Received',s:'Your application is in our system.',d:true},
      {l:'Under Review',s:'Being reviewed by our lending team (up to 5 business days).',d:['under_review','more_info','approved','declined'].includes(a.status)},
      {l:a.status==='approved'?'ðŸŽ‰ Approved!':a.status==='declined'?'Decision Made':'Final Decision',s:a.status==='approved'?'Congratulations! Your branch will contact you.':a.status==='declined'?'Please contact your branch for details.':'Within 15 business days.',d:['approved','declined'].includes(a.status)}
    ].map(x=>`<div class="tl-item"><div class="tl-dot${x.d?'':' off'}"></div><div class="tl-text"><strong>${x.l}</strong><span>${x.s}</span></div></div>`).join('');
    document.getElementById('result').style.display='block';
  }
</script>
</body>
</html>
