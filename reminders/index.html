<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Payment Reminder System ‚Äî Farm Credit SEMO</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',system-ui,sans-serif;background:#f4f7f0;color:#1e3013}
    header{background:#52812c;color:white;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
    header .logo{font-size:20px;font-weight:700}header .logo span{color:#8bc34a}
    header small{opacity:.7;font-size:13px;display:block;margin-top:2px}
    .container{max-width:660px;margin:0 auto;padding:24px 16px}
    .demo-banner{background:linear-gradient(90deg,#fff8e1,#fffde7);border:1.5px solid #ffc107;border-radius:10px;padding:12px 16px;margin-bottom:20px;font-size:13px;color:#856404;display:flex;align-items:center;gap:10px}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
    .stat{background:white;border-radius:12px;padding:18px;box-shadow:0 2px 12px rgba(0,0,0,.07);text-align:center}
    .stat .num{font-size:34px;font-weight:800;color:#52812c}
    .stat .lbl{font-size:12px;color:#888;margin-top:3px}
    .card{background:white;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.07);margin-bottom:20px}
    .card-head{padding:16px 20px;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
    .card-head h2{font-size:16px;font-weight:700;color:#52812c}
    table{width:100%;border-collapse:collapse}
    th{text-align:left;font-size:11px;text-transform:uppercase;color:#999;padding:10px 14px;border-bottom:2px solid #f0f0f0;letter-spacing:.5px}
    td{padding:12px 14px;border-bottom:1px solid #f5f5f5;font-size:14px;vertical-align:middle}
    tr:last-child td{border-bottom:none}
    .badge{display:inline-block;padding:3px 10px;border-radius:10px;font-size:11px;font-weight:600}
    .badge.ok{background:#d4edda;color:#155724}
    .badge.soon{background:#fff3cd;color:#856404}
    .badge.today{background:#f8d7da;color:#721c24}
    input[type=text],input[type=email],input[type=tel],input[type=number]{width:100%;padding:8px 12px;border:1.5px solid #ddd;border-radius:8px;font-size:14px;outline:none}
    input:focus{border-color:#52812c}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .field{margin-bottom:10px}
    .field label{display:block;font-size:12px;font-weight:500;color:#666;margin-bottom:4px}
    .btn{padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none}
    .btn-primary{background:#52812c;color:white;width:100%;padding:10px;margin-top:4px}
    .btn-primary:hover{background:#426824}
    .btn-sm{background:none;border:1.5px solid #52812c;color:#52812c;padding:4px 10px;font-size:12px;border-radius:6px;cursor:pointer}
    .btn-sm:hover{background:#52812c;color:white}
    .btn-danger{border-color:#ef4444;color:#ef4444}
    .btn-danger:hover{background:#ef4444;color:white}
    .btn-green{background:#8bc34a;color:#1e3013;border:none;padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    .log-item{padding:9px 0;border-bottom:1px solid #f5f5f5;font-size:13px}
    .log-item:last-child{border-bottom:none}
    .toast{position:fixed;bottom:24px;right:24px;background:#52812c;color:white;padding:14px 20px;border-radius:10px;font-size:14px;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,.2);transform:translateY(100px);transition:transform .3s;z-index:999}
    .toast.show{transform:translateY(0)}
    @media(max-width:700px){.stats{grid-template-columns:1fr}.grid{grid-template-columns:1fr}.grid-2{grid-template-columns:1fr}}
    @media (max-width: 768px) {
      .cards, .wrap, .container { max-width: 100%; padding: 0 16px 32px; }
      header h1 { font-size: 26px; }
      .stats-row, .stat-row { gap: 20px; }
    }
  </style>
</head>
<body>
<header>
  <div><div class="logo">Farm Credit <span>SEMO</span></div><small>Payment Reminder System ‚Äî Admin Dashboard</small></div>
  <button class="btn-green" onclick="runCheck()">‚ñ∂ Run Daily Check</button>
</header>
<div class="container">
  <div class="demo-banner">‚ö° <strong>Demo Mode</strong> ‚Äî This is a live preview. In production, reminders are sent via SMS (Twilio) and email (SMTP) automatically at 9 AM daily.</div>

  <div class="stats">
    <div class="stat"><div class="num" id="statActive">3</div><div class="lbl">Active Borrowers</div></div>
    <div class="stat"><div class="num" id="statToday">0</div><div class="lbl">Reminders Sent Today</div></div>
    <div class="stat"><div class="num" id="statTotal">0</div><div class="lbl">Total Reminders Sent</div></div>
  </div>

  <div class="card" style="grid-column:1/-1">
    <div class="card-head"><h2>üë• Borrowers</h2></div>
    <table>
      <thead><tr><th>Name</th><th>Loan #</th><th>Balance</th><th>Payment</th><th>Due Day</th><th>Status</th><th>Actions</th></tr></thead>
      <tbody id="borrowerTable"></tbody>
    </table>
  </div>

  <div class="grid">
    <div class="card" style="padding:20px">
      <h2 style="font-size:16px;font-weight:700;color:#52812c;margin-bottom:16px">‚ûï Add Borrower</h2>
      <div class="grid-2">
        <div class="field"><label>First & Last Name *</label><input type="text" id="aName" placeholder="John Farmer"/></div>
        <div class="field"><label>Loan Number</label><input type="text" id="aLoan" placeholder="FC-2025-001"/></div>
      </div>
      <div class="grid-2">
        <div class="field"><label>Email</label><input type="email" id="aEmail" placeholder="farmer@email.com"/></div>
        <div class="field"><label>Phone</label><input type="tel" id="aPhone" placeholder="+1 573 555 0000"/></div>
      </div>
      <div class="grid-2">
        <div class="field"><label>Loan Balance ($)</label><input type="number" id="aBal" placeholder="350000"/></div>
        <div class="field"><label>Payment Amount ($)</label><input type="number" id="aPay" placeholder="1850"/></div>
      </div>
      <div class="field"><label>Payment Due Day of Month (1‚Äì28) *</label><input type="number" id="aDay" placeholder="15" min="1" max="28"/></div>
      <button class="btn btn-primary" onclick="addBorrower()">Add Borrower</button>
    </div>

    <div class="card" style="padding:20px">
      <h2 style="font-size:16px;font-weight:700;color:#52812c;margin-bottom:12px">üìã Activity Log</h2>
      <div id="logList"><div style="color:#aaa;font-size:13px">No activity yet. Click "Run Daily Check" to simulate.</div></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  const TODAY = new Date().getDate();
  let borrowers = JSON.parse(localStorage.getItem('fc_borrowers') || 'null');
  let logs = JSON.parse(localStorage.getItem('fc_logs') || '[]');
  let sentToday = parseInt(localStorage.getItem('fc_sent_today') || '0');

  if (!borrowers) {
    const d = TODAY;
    borrowers = [
      {id:1,name:'John & Mary Farmer',email:'john@farmersemo.com',phone:'+15735550001',loan_number:'FC-2024-001',loan_balance:425000,payment_day:(d+10)%28||15,payment_amount:2187.50,active:true},
      {id:2,name:'Robert Tillman',email:'rob@tillmanfarms.com',phone:'+15735550002',loan_number:'FC-2024-042',loan_balance:780000,payment_day:(d+4)%28||20,payment_amount:3945.00,active:true},
      {id:3,name:'Emily Chen (AgSunrise)',email:'emily@chenfarm.com',phone:'+15735550003',loan_number:'AS-2025-008',loan_balance:120000,payment_day:(d+2)%28||22,payment_amount:612.00,active:true}
    ];
    save();
  }

  function save(){localStorage.setItem('fc_borrowers',JSON.stringify(borrowers));localStorage.setItem('fc_logs',JSON.stringify(logs));}

  function getDaysUntil(day){ return day - TODAY; }

  function statusBadge(d){
    if(d===0)return'<span class="badge today">DUE TODAY</span>';
    if(d>0&&d<=7)return`<span class="badge soon">${d}d away</span>`;
    if(d<0)return'<span class="badge ok">Paid ‚úì</span>';
    return`<span class="badge ok">${d}d away</span>`;
  }

  function render(){
    const active = borrowers.filter(b=>b.active);
    document.getElementById('statActive').textContent = active.length;
    document.getElementById('statToday').textContent = sentToday;
    document.getElementById('statTotal').textContent = logs.length;

    document.getElementById('borrowerTable').innerHTML = active.map(b=>{
      const d = getDaysUntil(b.payment_day);
      return `<tr>
        <td><strong>${b.name}</strong></td>
        <td style="color:#888">${b.loan_number||'‚Äî'}</td>
        <td>$${(b.loan_balance||0).toLocaleString()}</td>
        <td>$${(b.payment_amount||0).toFixed(2)}</td>
        <td style="font-weight:600;color:#52812c">Day ${b.payment_day}</td>
        <td>${statusBadge(d)}</td>
        <td style="display:flex;gap:6px">
          <button class="btn-sm" onclick="testReminder(${b.id})">üì® Test</button>
          <button class="btn-sm btn-danger" onclick="remove(${b.id})">‚úï</button>
        </td>
      </tr>`;
    }).join('');

    const logEl = document.getElementById('logList');
    if(!logs.length){logEl.innerHTML='<div style="color:#aaa;font-size:13px">No activity yet.</div>';return;}
    logEl.innerHTML = logs.slice(-8).reverse().map(l=>`
      <div class="log-item">
        <strong>${l.name}</strong> <span style="color:#aaa">‚Äî ${l.type} via ${l.channel}</span><br/>
        <span style="color:#52812c;font-size:12px">${l.status}</span> <span style="color:#bbb;font-size:11px">¬∑ ${l.time}</span>
      </div>`).join('');
  }

  function addBorrower(){
    const name=document.getElementById('aName').value.trim();
    const day=parseInt(document.getElementById('aDay').value);
    if(!name||!day){alert('Name and Payment Day are required');return;}
    const b={id:Date.now(),name,email:document.getElementById('aEmail').value,phone:document.getElementById('aPhone').value,loan_number:document.getElementById('aLoan').value,loan_balance:parseFloat(document.getElementById('aBal').value)||0,payment_day:day,payment_amount:parseFloat(document.getElementById('aPay').value)||0,active:true};
    borrowers.push(b);save();
    ['aName','aEmail','aPhone','aLoan','aBal','aPay','aDay'].forEach(id=>document.getElementById(id).value='');
    render();toast('‚úÖ Borrower added');
  }

  function remove(id){if(!confirm('Remove this borrower?'))return;borrowers=borrowers.map(b=>b.id===id?{...b,active:false}:b);save();render();}

  function testReminder(id){
    const b=borrowers.find(x=>x.id===id);
    const days=prompt('Simulate reminder for how many days out? (0, 3, or 7)','7');
    if(!days)return;
    const urgency=parseInt(days)===0?'TODAY':`in ${days} days`;
    logReminder(b,`${days}d_reminder`,`üì± SMS sent to ${b.phone}: "Payment of $${b.payment_amount?.toFixed(2)} due ${urgency}" ‚úÖ\nüìß Email sent to ${b.email} ‚úÖ`);
    render();
    alert(`‚úÖ Demo reminder sent!\n\nüì± SMS ‚Üí ${b.phone}\n"Farm Credit SEMO: Your payment of $${b.payment_amount?.toFixed(2)} is due ${urgency}. Loan #${b.loan_number}."\n\nüìß Email ‚Üí ${b.email}\nSubject: Farm Credit SEMO ‚Äî Payment Due ${urgency}`);
  }

  function logReminder(b,type,status){
    logs.push({name:b.name,type,channel:'sms+email',status:'‚úÖ Delivered',time:new Date().toLocaleTimeString()});
    sentToday++;
    localStorage.setItem('fc_sent_today',sentToday);
    save();
  }

  function runCheck(){
    const active=borrowers.filter(b=>b.active);
    let sent=0;
    active.forEach(b=>{
      const d=getDaysUntil(b.payment_day);
      if([0,3,7].includes(d)){logReminder(b,`${d}d_reminder`,'‚úÖ Delivered');sent++;}
    });
    render();
    toast(sent>0?`‚úÖ ${sent} reminder${sent>1?'s':''} sent!`:'No reminders due today');
  }

  function toast(msg){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),3000);}

  render();
</script>
<footer>
<div style="margin-top:32px;padding-top:24px;border-top:1px solid #e5e7eb;display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap">
  <div style="display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#d1fae5,#ecfdf5);border:2px solid #10b981;border-radius:8px;font-size:13px;font-weight:600;color:#065f46">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
      <polyline points="22 4 12 14.01 9 11.01"></polyline>
    </svg>
    <span>WCAG 2.1 AA</span>
  </div>
  
  <div style="display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#dbeafe,#eff6ff);border:2px solid #3b82f6;border-radius:8px;font-size:13px;font-weight:600;color:#1e40af">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>
    <span>Keyboard Accessible</span>
  </div>
  
  <div style="display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#fef3c7,#fffbeb);border:2px solid #f59e0b;border-radius:8px;font-size:13px;font-weight:600;color:#92400e">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
      <circle cx="12" cy="12" r="3"></circle>
    </svg>
    <span>Screen Reader Friendly</span>
  </div>
</div>

<p style="text-align:center;margin-top:16px;font-size:11px;color:#9ca3af">
  Built with accessibility in mind ¬∑ Tested with NVDA, VoiceOver, and Lighthouse
</p>

</footer>
<!-- Farm Credit AI Assistant Widget - Add before </body> -->
<div id="fc-chatbot-widget">
  <!-- Chat Button -->
  <button id="fc-chat-button" aria-label="Open Farm Credit AI Assistant" style="position:fixed;bottom:24px;right:24px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#345220,#52812c);border:none;box-shadow:0 4px 16px rgba(82,129,44,0.4);cursor:pointer;z-index:9999;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease">
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>

  <!-- Chat Modal -->
  <div id="fc-chat-modal" role="dialog" aria-labelledby="fc-chat-title" aria-modal="true" style="position:fixed;bottom:100px;right:24px;width:380px;max-width:calc(100vw - 48px);height:550px;max-height:calc(100vh - 150px);background:white;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.2);z-index:10000;display:none;flex-direction:column;overflow:hidden">
    
    <!-- Header -->
    <div style="background:linear-gradient(135deg,#345220,#52812c);color:white;padding:16px 20px;display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;align-items:center;gap:12px">
        <div style="width:40px;height:40px;background:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px">ü§ñ</div>
        <div>
          <div id="fc-chat-title" style="font-weight:700;font-size:16px">Farm Credit AI Assistant</div>
          <div style="font-size:12px;opacity:0.9">Online ¬∑ Ready to help</div>
        </div>
      </div>
      <button id="fc-chat-close" aria-label="Close chat" style="background:none;border:none;color:white;font-size:24px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:background 0.2s">√ó</button>
    </div>

    <!-- Messages -->
    <div id="fc-chat-messages" style="flex:1;overflow-y:auto;padding:20px;background:#f9fafb;display:flex;flex-direction:column;gap:12px">
      <!-- Welcome message -->
      <div class="fc-chat-message-bot">
        <div style="background:white;padding:12px 16px;border-radius:12px 12px 12px 4px;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
          <div style="font-size:14px;line-height:1.5">
            üëã Hi! I'm your Farm Credit AI Assistant. I can help you with:<br><br>
            ‚Ä¢ <strong>Patronage</strong> - Check your dividend estimates<br>
            ‚Ä¢ <strong>Loans</strong> - Application status & requirements<br>
            ‚Ä¢ <strong>AgSunrise</strong> - Young farmer programs<br>
            ‚Ä¢ <strong>Account</strong> - General questions<br><br>
            What can I help you with today?
          </div>
        </div>
        <div style="font-size:11px;color:#9ca3af;margin-top:4px;padding-left:4px">Just now</div>
      </div>
    </div>

    <!-- Input -->
    <div style="padding:16px;background:white;border-top:1px solid #e5e7eb">
      <div style="display:flex;gap:8px">
        <input id="fc-chat-input" type="text" placeholder="Type your message..." aria-label="Chat message" style="flex:1;padding:12px 16px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;outline:none" />
        <button id="fc-chat-send" aria-label="Send message" style="background:linear-gradient(135deg,#345220,#52812c);color:white;border:none;width:44px;height:44px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
      
      <!-- Quick Actions -->
      <div id="fc-quick-actions" style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
        <button class="fc-quick-btn" data-message="What is my patronage dividend?">üí∞ Patronage</button>
        <button class="fc-quick-btn" data-message="Check my loan application status">üìã Loan Status</button>
        <button class="fc-quick-btn" data-message="Tell me about AgSunrise">üå± AgSunrise</button>
        <button class="fc-quick-btn" data-message="I need help with my account">‚ùì Help</button>
      </div>
    </div>
  </div>
</div>

<style>
/* Chat button hover */
#fc-chat-button:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 24px rgba(82,129,44,0.5);
}

#fc-chat-button:active {
  transform: scale(1.05);
}

#fc-chat-close:hover {
  background: rgba(255,255,255,0.2);
}

/* Quick action buttons */
.fc-quick-btn {
  background: #f3f4f6;
  border: 1px solid #e5e7eb;
  padding: 6px 12px;
  border-radius: 16px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.fc-quick-btn:hover {
  background: #e5e7eb;
  border-color: #52812c;
}

/* Chat input focus */
#fc-chat-input:focus {
  border-color: #52812c;
  box-shadow: 0 0 0 3px rgba(82,129,44,0.1);
}

/* Scrollbar */
#fc-chat-messages::-webkit-scrollbar {
  width: 6px;
}

#fc-chat-messages::-webkit-scrollbar-thumb {
  background: #d1d5db;
  border-radius: 3px;
}

#fc-chat-messages::-webkit-scrollbar-thumb:hover {
  background: #9ca3af;
}

/* Message styles */
.fc-chat-message-user {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.fc-chat-message-user > div:first-child {
  background: linear-gradient(135deg,#345220,#52812c);
  color: white;
  padding: 12px 16px;
  border-radius: 12px 12px 4px 12px;
  max-width: 80%;
  font-size: 14px;
  line-height: 1.5;
}

.fc-chat-message-bot {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

/* Mobile responsive */
@media (max-width: 480px) {
  #fc-chat-button {
    bottom: 16px;
    right: 16px;
    width: 56px;
    height: 56px;
  }
  
  #fc-chat-modal {
    bottom: 88px;
    right: 16px;
    left: 16px;
    width: auto;
    max-width: none;
  }
}

/* Typing indicator */
.fc-typing {
  display: flex;
  gap: 4px;
  padding: 12px 16px;
  background: white;
  border-radius: 12px 12px 12px 4px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  width: fit-content;
}

.fc-typing span {
  width: 8px;
  height: 8px;
  background: #9ca3af;
  border-radius: 50%;
  animation: fc-typing-animation 1.4s infinite;
}

.fc-typing span:nth-child(2) {
  animation-delay: 0.2s;
}

.fc-typing span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes fc-typing-animation {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-8px);
  }
}
</style>

<script>
(function() {
  // Chat state
  let chatOpen = false;
  
  // DOM elements
  const chatButton = document.getElementById('fc-chat-button');
  const chatModal = document.getElementById('fc-chat-modal');
  const chatClose = document.getElementById('fc-chat-close');
  const chatInput = document.getElementById('fc-chat-input');
  const chatSend = document.getElementById('fc-chat-send');
  const chatMessages = document.getElementById('fc-chat-messages');
  const quickActions = document.querySelectorAll('.fc-quick-btn');
  
  // Demo responses
  const responses = {
    'patronage': 'Your estimated 2024 patronage dividend is <strong>$3,250</strong> based on your current loan balance. This is part of our record <strong>$9.1M distribution</strong>! üí∞',
    'loan': 'Your loan application <strong>#AG2024-0157</strong> is currently in <strong>Underwriting Review</strong>. Expected decision within 5-7 business days. You\'ll receive email/SMS updates. üìã',
    'agsunrise': '<strong>AgSunrise</strong> is our young & beginning farmer program! It includes:<br>‚Ä¢ Reduced interest rates<br>‚Ä¢ Flexible terms<br>‚Ä¢ Mentorship matching<br>‚Ä¢ Free financial education<br><br>Apply at <a href="agsunrise/index.html" style="color:#52812c">farmcreditsemo.com/agsunrise</a> üå±',
    'help': 'I can help with:<br>‚Ä¢ Account questions<br>‚Ä¢ Payment schedules<br>‚Ä¢ Document uploads<br>‚Ä¢ Contact info updates<br><br>Or call us at <strong>(877) 730-7327</strong> for immediate assistance. ‚ùì',
    'default': 'Thanks for your question! For specific account details, please call us at <strong>(877) 730-7327</strong> or email <strong>support@farmcreditsemo.com</strong>. Our team is ready to help! üòä'
  };
  
  // Toggle chat
  function toggleChat() {
    chatOpen = !chatOpen;
    chatModal.style.display = chatOpen ? 'flex' : 'none';
    if (chatOpen) {
      chatInput.focus();
      // Hide quick actions after first open (keep it clean)
      setTimeout(() => {
        const quickActionsContainer = document.getElementById('fc-quick-actions');
        if (quickActionsContainer && chatMessages.children.length > 1) {
          quickActionsContainer.style.display = 'none';
        }
      }, 100);
    }
  }
  
  // Add message
  function addMessage(text, isUser = false) {
    const msgDiv = document.createElement('div');
    msgDiv.className = isUser ? 'fc-chat-message-user' : 'fc-chat-message-bot';
    
    const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    
    if (isUser) {
      msgDiv.innerHTML = `
        <div>${text}</div>
        <div style="font-size:11px;color:#9ca3af;margin-top:4px;padding-right:4px">${time}</div>
      `;
    } else {
      msgDiv.innerHTML = `
        <div style="background:white;padding:12px 16px;border-radius:12px 12px 12px 4px;box-shadow:0 1px 3px rgba(0,0,0,0.1)">
          <div style="font-size:14px;line-height:1.5">${text}</div>
        </div>
        <div style="font-size:11px;color:#9ca3af;margin-top:4px;padding-left:4px">${time}</div>
      `;
    }
    
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  
  // Show typing indicator
  function showTyping() {
    const typingDiv = document.createElement('div');
    typingDiv.className = 'fc-chat-message-bot';
    typingDiv.id = 'fc-typing-indicator';
    typingDiv.innerHTML = '<div class="fc-typing"><span></span><span></span><span></span></div>';
    chatMessages.appendChild(typingDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  
  // Remove typing indicator
  function hideTyping() {
    const typingIndicator = document.getElementById('fc-typing-indicator');
    if (typingIndicator) typingIndicator.remove();
  }
  
  // Get response
  function getResponse(message) {
    const msg = message.toLowerCase();
    
    if (msg.includes('patronage') || msg.includes('dividend') || msg.includes('refund')) {
      return responses.patronage;
    } else if (msg.includes('loan') || msg.includes('application') || msg.includes('status')) {
      return responses.loan;
    } else if (msg.includes('agsunrise') || msg.includes('young farmer') || msg.includes('beginning')) {
      return responses.agsunrise;
    } else if (msg.includes('help') || msg.includes('support') || msg.includes('account')) {
      return responses.help;
    } else {
      return responses.default;
    }
  }
  
  // Send message
  function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;
    
    // Add user message
    addMessage(message, true);
    chatInput.value = '';
    
    // Show typing
    showTyping();
    
    // Simulate AI response delay
    setTimeout(() => {
      hideTyping();
      const response = getResponse(message);
      addMessage(response);
    }, 800 + Math.random() * 400); // 800-1200ms delay
  }
  
  // Event listeners
  chatButton.addEventListener('click', toggleChat);
  chatClose.addEventListener('click', toggleChat);
  chatSend.addEventListener('click', sendMessage);
  
  chatInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      sendMessage();
    }
  });
  
  quickActions.forEach(btn => {
    btn.addEventListener('click', () => {
      const message = btn.getAttribute('data-message');
      chatInput.value = message;
      sendMessage();
    });
  });
  
  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && chatOpen) {
      toggleChat();
    }
  });
  
  // Close modal when clicking outside
  chatModal.addEventListener('click', (e) => {
    if (e.target === chatModal) {
      toggleChat();
    }
  });
})();
</script>

</body>
</html>
